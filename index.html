<!DOCTYPE html>
<html lang="ru">
   <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <link rel="icon" type="image/png" href="favicon.png">
      <title>Risk Calc</title>
      <style>
         :root {
         --accent: #00ffaa;
         --shadow-color: rgba(0, 255, 170, 0.3);
         --copy-hover: #00db8b;
         }
         body {
         margin: 0;
         font-family: 'Segoe UI', sans-serif;
         background: #0e0e0e;
         color: #f0f0f0;
         display: flex;
         justify-content: center;
         align-items: flex-start;
         min-height: 90vh;
         padding: 1rem;
         overflow-y: auto;
         }
         .container {
         background: #1e1e1e;
         padding: 1.5rem;
         padding-top: 0.8rem;
         border-radius: 15px;
         box-shadow: 0 0 15px var(--shadow-color);
         width: 100%;
         max-width: 600px;
         font-size: 1rem;
         }
         @media (max-width: 480px) {
         .container {
         padding: 1rem;
         font-size: 0.95rem;
         }
         input,
         .risk-toggle button,
         .deal-toggle button,
         #copyBtn {
         font-size: 0.95rem;
         padding: 10px;
         }
         .result {
         font-size: 0.95rem;
         }
         }
         h2 {
         margin-top: 0rem;
         text-align: center;
         margin-bottom: 0.8rem;
         color: var(--accent);
         }
         .trade-toggle {
         display: flex;
         justify-content: center;
         margin-bottom: 1rem;
         }
         .trade-toggle button {
         background: transparent;
         color: #fff;
         border: none;
         padding: 10px 14px;
         font-weight: bold;
         font-size: 1rem;
         cursor: pointer;
         transition: background 0.2s;
         }
         .trade-toggle button.active {
         background: var(--accent);
         color: #000;
         border-radius: 8px;
         }
         label {
         display: block;
         margin-top: 0.5rem;
         font-weight: bold;
         }
         input {
         margin-top: .2rem;
         padding: 10px;
         width: 100%;
         border-radius: 8px;
         border: 1px solid transparent;
         background: #2b2b2b;
         color: #fff;
         font-size: 1rem;
         box-sizing: border-box;
         }
         input:focus {
         outline: none;
         box-shadow: 0 0 5px var(--accent);
         border: 1px solid var(--accent);
         }
         .result {
         margin-top: 1.5rem;
         background: #2a2a2a;
         padding: 1rem;
         border-radius: 10px;
         line-height: 1.6;
         user-select: text;
         font-size: 1.05rem;
         word-wrap: break-word;
         }
         .result strong {
         color: var(--accent);
         }
         #copyBtn {
         margin-top: 1rem;
         padding: 10px;
         background: var(--accent);
         color: #000;
         border: none;
         border-radius: 8px;
         width: 100%;
         font-weight: bold;
         font-size: 1rem;
         cursor: pointer;
         display: none;
         transition: all 0.3s ease;
         }
         #copyBtn:hover {
         background: var(--copy-hover);
         }
         #copyBtn.glow {
         background: var(--accent);
         box-shadow: 0 0 15px var(--accent);
         }
         .risk-row {
         display: flex;
         align-items: center;
         gap: 10px;
         margin-top: .5rem;
         }
         .risk-toggle {
         display: flex;
         background: #2b2b2b;
         border-radius: 8px;
         overflow: hidden;
         }
         .risk-toggle button {
         background: transparent;
         color: #fff;
         border: none;
         padding: 10px 12px;
         cursor: pointer;
         font-weight: bold;
         font-size: 1rem;
         transition: background 0.2s;
         }
         .risk-toggle button.active {
         background: var(--accent);
         color: #000;
         }
         .risk-row input {
         flex: 1;
         }
         .deal-toggle {
         display: flex;
         width: 100%;
         background: #2b2b2b;
         border-radius: 8px;
         overflow: hidden;
         margin-bottom: 1rem;
         }
         .deal-toggle button {
         flex: 1;
         background: transparent;
         color: #fff;
         border: none;
         padding: 10px 12px;
         cursor: pointer;
         font-weight: bold;
         font-size: 1rem;
         text-align: center;
         transition: background 0.2s;
         }
         .deal-toggle button:first-child {
         text-align: right;
         padding-left: 14px;
         }
         .deal-toggle button:last-child {
         text-align: left;
         padding-right: 14px;
         }
         .deal-toggle button.active {
         background: var(--accent);
         color: #000;
         }
         .atr-button {
         background: var(--accent);
         color: #000;
         text-decoration: none;
         font-weight: bold;
         padding: 2px 6px;
         border-radius: 8px;
         transition: background 0.3s ease, box-shadow 0.3s ease;
         white-space: nowrap;
         font-size: 0.8rem;
         }
         .atr-button:hover {
         background: var(--copy-hover);
         box-shadow: 0 0 10px var(--shadow-color);
         }
         #atr-modal {
         position: fixed;
         top: 0;
         left: 0;
         right: 0;
         bottom: 0;
         background: rgba(0, 0, 0, 0.7);
         backdrop-filter: blur(4px);
         z-index: 1000;
         display: flex;
         justify-content: center;
         align-items: flex-start; 
         overflow-y: auto;
         padding-top: 4vh;
         padding-bottom: 4vh;
         }
         #atr-modal .container {
         background: #1e1e1e;
         padding: 1rem 1.2rem;
         border-radius: 12px;
         box-shadow: 0 0 10px var(--shadow-color);
         width: 100%;
         max-width: 400px;
         position: relative;
         }
         #atr-modal h2 {
         text-align: center;
         margin: 0 0 0.8rem 0;
         color: var(--accent);
         }
         #atr-modal table {
         border-collapse: collapse;
         width: 100%;
         }
         #atr-modal th,
         #atr-modal td {
         padding: 3px 2px;
         text-align: center;
         }
         #atr-modal th {
         color: var(--accent);
         background: #262626;
         }
         #atr-modal td {
         background: #2c2c2c;
         }
         #atr-modal input {
         width: 90%;
         padding: 3px 4px;
         font-size: 1rem;
         background: #3a3a3a;
         color: #fff;
         border: 1px solid transparent;
         border-radius: 4px;
         }
         #atr-modal input:focus {
         outline: none;
         border: 1px solid var(--accent);
         box-shadow: 0 0 4px var(--accent);
         }
         #atr-modal .calc-btn {
         margin-top: 1rem;
         width: 100%;
         text-align: center;
         padding: 8px;
         font-size: 1rem;
         font-weight: bold;
         background: var(--accent);
         color: #000;
         border: none;
         border-radius: 6px;
         cursor: pointer;
         }
         #atr-modal .atr-result {
         margin-top: 0.8rem;
         background: #252525;
         padding: 0.6rem 0.8rem;
         border-radius: 6px;
         font-size: 1rem;
         text-align: center;
         font-weight: bold;
         }
         .close-btn {
         position: absolute;
         top: 10px;
         right: 14px;
         background: transparent;
         color: #888;
         border: none;
         font-size: 1.8rem;
         font-weight: bold;
         cursor: pointer;
         transition: color 0.2s ease;
         z-index: 10;
         }
         .close-btn:hover {
         color: var(--accent);
         }
      </style>
   </head>
   <body>
      <div class="container">
         <h2>РИСК КАЛЬКУЛЯТОР</h2>
         <div class="deal-toggle">
            <button id="btnLong" onclick="setTradeType('long')">ЛОНГ</button>
            <button id="btnShort" onclick="setTradeType('short')">ШОРТ</button>
         </div>
         <label for="deposit">Депозит:</label>
         <input type="number" id="deposit" value="10000" oninput="calculate()">
         <label>Риск на сделку:</label>
         <div class="risk-row">
            <input type="number" id="riskValue" value="1" oninput="calculate()">
            <div class="risk-toggle">
               <button id="btnPercent" onclick="setRiskType('percent')">%</button>
               <button id="btnFixed" onclick="setRiskType('fixed')">Фикс</button>
            </div>
         </div>
         <label for="CoinPrice">Цена монеты:</label>
         <input type="number" id="CoinPrice" value="60000" oninput="calculate()">
         <label for="atr">ATR (<span id="atrPeriodLabel">14</span>):
         <a href="#" class="atr-button" onclick="openAtrModal(); return false;">Рассчитать</a>
         </label>
         <div class="risk-row">
            <input type="number" id="atr" value="1200" oninput="calculate()">
            <div class="risk-toggle">
               <button id="btnATR14" onclick="setATRPeriod(14)">14</button>
               <button id="btnATR5" onclick="setATRPeriod(5)">5</button>
            </div>
         </div>
         <div class="result" id="result"></div>
         <button id="copyBtn" onclick="copyResultToClipboard()">Копировать в буфер</button>
      </div>
      <div id="atr-modal" class="modal" style="display:none;">
         <div class="container">
            <button class="close-btn" onclick="closeAtrModal()">×</button>
            <h2>ATR КАЛЬКУЛЯТОР</h2>
            <div id="atr-inputs">
            </div>
            <button class="calc-btn" onclick="calculateATR()">Рассчитать</button>
            <div id="atr-result" class="atr-result"></div>
         </div>
      </div>
      <script>
         let currentRiskType = 'percent';
         let currentTradeType = 'long';
         let currentATRPeriod = 14;
         
         function setRiskType(type) {
           currentRiskType = type;
           document.getElementById("btnPercent").classList.toggle("active", type === "percent");
           document.getElementById("btnFixed").classList.toggle("active", type === "fixed");
           calculate();
         }
         
         function setTradeType(type) {
           currentTradeType = type;
           document.getElementById("btnLong").classList.toggle("active", type === "long");
           document.getElementById("btnShort").classList.toggle("active", type === "short");
           calculate();
         }
         
         function setATRPeriod(period) {
         currentATRPeriod = period;
         document.getElementById("atrPeriodLabel").textContent = period;
         document.getElementById("btnATR14").classList.toggle("active", period === 14);
         document.getElementById("btnATR5").classList.toggle("active", period === 5);
         calculate();
         }
         
         function openAtrModal() {
         document.getElementById('atr-modal').style.display = 'flex';
         const atrInputs = document.getElementById("atr-inputs");
         atrInputs.innerHTML = `
         <table>
         <thead><tr><th>Бар</th><th>High</th><th>Low</th></tr></thead>
         <tbody>
         ${Array.from({ length: currentATRPeriod }, (_, i) => `
          <tr>
         <td>${i + 1}</td>
         <td><input type="number" step="0.01" id="high${i}"></td>
         <td><input type="number" step="0.01" id="low${i}"></td>
          </tr>
         `).join('')}
         </tbody>
         </table>
         `;
         document.getElementById("atr-result").textContent = '';
         }
         
         function closeAtrModal() {
         document.getElementById('atr-modal').style.display = 'none';
         }
         
         function calculateATR() {
         let sum = 0, count = 0;
         for (let i = 0; i < currentATRPeriod; i++) {
         const high = parseFloat(document.getElementById(`high${i}`).value);
         const low = parseFloat(document.getElementById(`low${i}`).value);
         if (!isNaN(high) && !isNaN(low)) {
         sum += high - low;
         count++;
         }
         }
         const resultElem = document.getElementById("atr-result");
         if (count === 0) {
         resultElem.textContent = "⚠️ Введите хотя бы одну пару значений High и Low.";
         } else {
         const atr = sum / count;
         resultElem.textContent = `ATR (${count}): ${atr.toFixed(2)}`;
         document.getElementById('atr').value = atr.toFixed(2);
         calculate();
         }
         }
         
         function calculate() {
           const deposit = parseFloat(document.getElementById("deposit").value);
           const riskValue = parseFloat(document.getElementById("riskValue").value);
           const CoinPrice = parseFloat(document.getElementById("CoinPrice").value);
           const atr = parseFloat(document.getElementById("atr").value);
           const resultDiv = document.getElementById("result");
           const copyBtn = document.getElementById("copyBtn");
           if ([deposit, riskValue, CoinPrice, atr].some(v => isNaN(v) || v <= 0)) {
             resultDiv.innerHTML = "<span style='color:white; font-weight:bold;'>⚠️ Пожалуйста, заполните поля корректно!</span>";
             copyBtn.style.display = "none";
             return;
           }
           let stopMultiplier = currentATRPeriod === 14 ? 0.4 : 0.6;
           let takeMultiplier = currentATRPeriod === 14 ? 0.8 : 1.2;
           const stop = atr * stopMultiplier;
           const take = atr * takeMultiplier;
           const riskAmount = currentRiskType === 'percent' ? deposit * (riskValue / 100) : riskValue;
           const CoinSize = riskAmount / stop;
           const positionSize = CoinSize * CoinPrice;
           let stopLoss, takeProfit;
           if (currentTradeType === 'long') {
             stopLoss = CoinPrice - stop;
             takeProfit = CoinPrice + take;
           } else {
             stopLoss = CoinPrice + stop;
             takeProfit = CoinPrice - take;
           }
           const rrRatio = take / stop;
           resultDiv.innerHTML = `
         <strong>Риск:</strong> ${riskAmount.toFixed(2)}<br>
         <strong>Тип сделки:</strong> ${currentTradeType.toUpperCase()}<br>
         <strong>Стоп (${stopMultiplier} ATR):</strong> ${stop.toFixed(2)}<br>
         <strong>Тейк (${takeMultiplier} ATR):</strong> ${take.toFixed(2)}<br>
         <strong>Размер позиции:</strong> ${CoinSize.toFixed(6)}<br>
         <strong>Объём позиции:</strong> ${positionSize.toFixed(2)}<br>
         <strong>Цена входа:</strong> ${CoinPrice.toFixed(2)}<br>
         <strong>Стоп-лосс:</strong> ${stopLoss.toFixed(2)}<br>
         <strong>Тейк-профит:</strong> ${takeProfit.toFixed(2)}<br>
         <strong>Соотношение прибыль/риск:</strong> ${rrRatio.toFixed(1)} : 1`;
           copyBtn.textContent = "Копировать в буфер";
           copyBtn.classList.remove("glow");
           copyBtn.style.display = "block";
         }
         function setATRPeriod(period) {
         currentATRPeriod = period;
         document.getElementById("btnATR14").classList.toggle("active", period === 14);
         document.getElementById("btnATR5").classList.toggle("active", period === 5);
         document.getElementById("atrPeriodLabel").textContent = period;
         calculate();
         }
         
         function copyResultToClipboard() {
           const text = document.getElementById("result").innerText;
           const btn = document.getElementById("copyBtn");
           navigator.clipboard.writeText(text).then(() => {
             btn.textContent = "Скопировано!";
             btn.classList.add("glow");
             setTimeout(() => {
               btn.textContent = "Копировать в буфер";
               btn.classList.remove("glow");
             }, 2000);
           });
         }
         
         function setTradeType(type) {
         currentTradeType = type;
         document.getElementById("btnLong").classList.toggle("active", type === "long");
         document.getElementById("btnShort").classList.toggle("active", type === "short");
         const root = document.documentElement;
         if (type === "short") {
         root.style.setProperty("--accent", "#ff5555");
         root.style.setProperty("--shadow-color", "rgba(255, 85, 85, 0.3)");
         root.style.setProperty("--copy-hover", "#e14444");
         } else {
         root.style.setProperty("--accent", "#00ffaa");
         root.style.setProperty("--shadow-color", "rgba(0, 255, 170, 0.3)");
         root.style.setProperty("--copy-hover", "#00db8b");
         }
         calculate();
         }
         
         window.addEventListener("DOMContentLoaded", () => {
           setRiskType("percent");
           setTradeType("long");
         setATRPeriod(14);
         });
      </script>
   </body>
</html>
